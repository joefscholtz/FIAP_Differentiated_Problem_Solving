\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamertheme}[2025/12/12 Custom Beamer Theme]

\RequirePackage{tikz}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{shapes.misc}
\RequirePackage{fontawesome5}
\RequirePackage{microtype}
\RequirePackage{etoolbox}
\RequirePackage[T1]{fontenc}
\RequirePackage{sourcesanspro} 

\mode<presentation>

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Colors
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\definecolor{cardinalred}{RGB}{140,21,21} 
\definecolor{coolgrey}{RGB}{77,79,83} 
\definecolor{lightgrey}{HTML}{f8f8f8} 

\colorlet{primarycolor}{white}
\colorlet{invertedprimarycolor}{black}
\colorlet{secondarycolor}{lightgrey}
\colorlet{accentcolor}{cardinalred}
\colorlet{secondaryaccentcolor}{white}

\colorlet{emailcolor}{secondarycolor}
\colorlet{headercolor}{coolgrey}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Beamer General Settings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Itemize Bullet Colors
\setbeamercolor{itemize item}{fg=black}
\setbeamercolor{itemize subitem}{fg=black}
\setbeamercolor{itemize subsubitem}{fg=black}
\setbeamercolor{section head}{fg=accentcolor}

% Itemize Bullet Shapes
\setbeamertemplate{itemize item}[circle]
\setbeamertemplate{itemize subitem}{{\textendash}}
\setbeamertemplate{itemize subsubitem}[triangle]

% Font Settings
\setbeamercolor{title}{fg=invertedprimarycolor}

\setbeamerfont{subtitle}{series=\scshape}
\setbeamercolor{subtitle}{fg=invertedprimarycolor}

\setbeamerfont{author}{family=\sourcesanspro}
\setbeamercolor{author}{fg=invertedprimarycolor}

\setbeamerfont{institute}{family=\sourcesanspro}
\setbeamercolor{institute}{fg=accentcolor}

\setbeamerfont{email}{family=\sourcesanspro}
\setbeamercolor{email}{fg=emailcolor}

\setbeamerfont{date}{family=\sourcesanspro}
\setbeamercolor{date}{fg=secondaryaccentcolor}

\setbeamerfont{frametitle}{series=\scshape}
\setbeamercolor{frametitle}{fg=black}

% Email handling
% Initialize @email to avoid errors if user doesn't define it
\def\@email{} 
\newcommand{\email}[1]{\def\@email{\texttt{\MakeLowercase{\textls[10]{#1}}}}}

% Navigation Symbols (Adding page numbers)
\addtobeamertemplate{navigation symbols}{}{%
    \usebeamerfont{footline}%
    \usebeamercolor[fg]{footline}%
    \hspace{1em}%
    \insertframenumber/\inserttotalframenumber
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title Page
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newtoggle{showInstituteLogo}
\togglefalse{showInstituteLogo} 

\newcommand{\instituteLogo}{} 
\newcommand{\instituteThumb}{} 

\newcommand{\useInstituteLogo}[1]{%
  \toggletrue{showInstituteLogo}
  \renewcommand{\instituteLogo}{#1}%
}

\newcommand{\useInstituteThumb}[1]{%
  \renewcommand{\instituteThumb}{#1}%
}

\setbeamertemplate{title page}[default][left] 

% Custom Title Page Template
\defbeamertemplate*{title page}{customized}[1][]
{
  \begin{minipage}[c]{0.1\textwidth}
    \text{ }
  \end{minipage}
  \begin{minipage}[c]{0.8\textwidth}
    \setbeamercolor{background canvas}{bg=primarycolor}

    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (CircleCenter) at ([xshift=0, yshift=0cm] current page.center);
        
        \fill[fill=primarycolor] (CircleCenter) circle (10cm);

        % [fill=colorname!alpha]
        \fill[fill=secondarycolor] (CircleCenter) circle (8cm);
        
        \fill[fill=primarycolor] (CircleCenter) circle (6cm);
    \end{tikzpicture}
    
    \vspace{-1.2cm}
    \centering{
      \iftoggle{showInstituteLogo}{
        % If toggle is TRUE, show the image
        % \insertinstitute now holds the image path provided by the user
        \begin{figure}
            \instituteLogo
        \end{figure}
      }{
        % If toggle is FALSE, show the text (Standard behavior)
        \usebeamerfont{institute}{\usebeamercolor[fg]{institute}\textls[100]{\textsc{\insertinstitute}}}\par
      }
      \bigskip
      \usebeamerfont{title}\usebeamercolor[fg]{title}\textls[100]{\MakeUppercase{\textbf{\inserttitle}}}\par
      \smallskip
      \usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\textls[100]{\textsc{\insertsubtitle}}\par\par
    }
    \vspace{8mm}
    \usebeamerfont{author}\usebeamercolor[fg]{author}\textls[100]{\textsc{\insertauthor}}\par
    \smallskip
    {\usebeamercolor[fg]{email}\@email}\par
    \vfill
    \begin{figure}
      \centering
      \begin{tikzpicture}
        \node[fill=accentcolor, rounded rectangle, minimum width=1.1cm, minimum height=0.6cm] at (0, 0) {\footnotesize{\textbf{\usebeamercolor[fg]{date}{\usebeamerfont{date}{\insertdate}}}}};
      \end{tikzpicture}
    \end{figure}
  \end{minipage}
  \vspace{-1cm}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Table of contents
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\def\@toctittle{Table of Contents}
\newcommand{\toctittle}[1]{
  \def\@toctittle{#1}
}
\newcommand{\inserttoctittle}{
    \@toctittle
}

% style of section presented in the table of contents
\setbeamertemplate{section in toc}{%
  \tikz{\draw[fill=invertedprimarycolor] (0,0) circle (3pt);}
  \hspace{1mm}{\usebeamerfont{subtitle}\usebeamercolor[fg]{frametitle}{\textsc{\textbf{\inserttocsectionnumber ) \inserttocsection}}}}\par%
}
\setbeamertemplate{subsection in toc}{%
  \hspace{3mm}$\blacktriangleright$
  \hspace{1mm}{\usebeamerfont{subtitle}\usebeamercolor[fg]{frametitle}{\textsc{\textbf{\inserttocsectionnumber.\inserttocsubsectionnumber ) \inserttocsubsection}}}}\par%
}


% avoid numbering of frames that are breaked into multiply slides
\setbeamertemplate{frametitle continuation}{}

\newcommand{\InsertTocFrame}{
  {
    \setbeamercolor{background canvas}{bg=primarycolor}
    \setbeamercolor{title}{fg=invertedprimarycolor}
    \setbeamercolor{normal text}{fg=invertedprimarycolor}
    \setbeamercolor{frametitle}{fg=invertedprimarycolor}

    \begin{frame}
      \begin{tikzpicture}[remember picture, overlay]
        \coordinate (CircleCenter) at ([xshift=-7.5cm, yshift=0cm] current page.center);

        \fill[fill=secondarycolor] (CircleCenter) circle (8cm);

        \fill[fill=primarycolor] (CircleCenter) circle (6cm);
      \end{tikzpicture}

      \begin{minipage}[c]{0.6\textwidth}
        \begin{minipage}[c]{0.45\textwidth}
          \centering
          \fontsize{35}{35}{\textcolor{accentcolor}{\faIcon{clipboard-list}}}

          \vspace{5mm}
          \usebeamercolor[fg]{title}{\usebeamerfont{title}\textls[100]{\MakeUppercase{\textbf{\inserttoctittle}}}\par}
          % \usebeamerfont{title}\textls[100]{\textbf{\inserttoctittle}}\par
        \end{minipage}
      \end{minipage}
      \begin{minipage}[c]{0.38\textwidth}
        \tableofcontents
      \end{minipage}
    \end{frame}
  }

}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Frame Title 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setbeamertemplate{frametitle}{   
    \vspace*{-2mm}
    \begin{center}
        \footnotesize
        \textcolor{headercolor}{\inserttitle}
    \end{center}
    \vspace*{-2mm}
    \begin{minipage}[t]{0.5\textwidth}
      % Logic to handle section vs frame titles
      \vspace{-7mm}
      \hspace{-5mm}\small{\textcolor{accentcolor}{\faIcon{bars}}}

      \vspace{-1mm}
      \hspace{2mm}\textbf{\large{\insertframetitle}}

      \ifdefempty{\insertsectionhead}{%
        \text{ }
      }{%
        \hspace{2mm}\textcolor{accentcolor}{\normalsize{\insertsectionhead}}\ifdefempty{\insertsubsectionhead}{
          \text{ }
        }{%
          \textcolor{accentcolor}{\normalsize{: \insertsubsectionhead}}
        }
      } 
      
    \end{minipage}
    \begin{minipage}[t]{0.48\textwidth}
      \vspace{-1.25cm}
      \begin{figure}
        \begin{flushright}
          \includegraphics[height=1.2cm]{\instituteThumb}
        \end{flushright}
      \end{figure}
    \end{minipage}

}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Section Divider Slides
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\AtBeginSection[]{
    {
    \setbeamercolor{background canvas}{bg=primarycolor}
    \setbeamercolor{title}{fg=invertedprimarycolor}

    \begin{frame}
      \begin{tikzpicture}[remember picture, overlay]
        \coordinate (CircleCenter) at ([xshift=0, yshift=0cm] current page.center);
        
        % [fill=colorname!alpha]
        \fill[fill=secondarycolor] (CircleCenter) circle (8cm);
        
        \fill[fill=primarycolor] (CircleCenter) circle (6cm);
      \end{tikzpicture}
      \vfill
      \centering
      \begin{beamercolorbox}[sep=8pt,center]{title}
        {\usebeamerfont{title}\usebeamercolor[fg]{title}{\textsc{\insertsectionnumber\protect~\text{.}\insertsectionhead}}}\par%
      \end{beamercolorbox}
      \vfill
    \end{frame}
  }
}

\mode<all>

